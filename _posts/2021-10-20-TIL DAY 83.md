---
layout: single
title: TIL DAY 83
---
# HTTPS, Hashing, Cookie, Session

### HTTPS 프로토콜

HTTPS는 Hyper Text Transfer Protocol Secure Socket layer의 약자이다. HTTP over SSL(TLS), HTTP over Secure라고 부르기도 한다. HTTPS는 HTTP 요청을 SSL 혹은 TLS라는 알고리즘을 이용해, HTTP 통신을 하는 과정에서 내용을 암호화하여 데이터를 전송하는 방법이다.

SSL, TLS는 웹 서버와 사용자의 웹 브라우저 간 통신을 암호화 하는데 쓰이는 프로토콜이다. 공개키와 개인키를 통해서 보안 세션을 생성한다. TLS는 SSL보다 조금 더 많은 암호화를 하기 때문에 안전하다.

클라이언트는 서버에 데이터 요청을 하고 이후 받은 데이터를 이용해서 화면을 렌더링하는 등의 작업을 한다. 그렇기 때문에 요청 및 응답을 중간에서 가로채는 중간자 공격(클라이언트와 서버 사이에서 공격자가 서로의 요청, 응답의 데이터를 탈취 및 변조하여 다시 전송하는 공격)에 취약하다. 서버가 해당 '데이터는 [https://example.com](https://example.com/) 도메인에서 제공되었습니다.'라는 추가데이터를 응답객체에 실어 보낸다면 '중간자 공격'으로 인해 다른 도메인에서 데이터를 받은 클라이언트는 데이터를 제공한 도메인과 전달받은 내용의 도메인을 비교하여 '중간자 공격'이 존재하는지 아닌지 확인할 수 있다. 중간자 공격으로 인해 이런 추가 데이터 또한 변조할 수 있기 때문에 해당 데이터를 암호화시키는 작업이 필요하다.

### 암호화

HTTPS 프로토콜의 특징 중 하나는 암호화된 데이터를 주고받기 때문에, 중간에 인터넷 요청이 탈취되더라도 그 내용을 알아볼 수 없다. 비밀번호와 같은 중요한 데이터가 유출될 가능성이 HTTP 프로토콜보다 현저히 적어지게 된다. 정확한 키로 복호화 하기전까지는 어떤 내용인지 알 수 없다.

### 인증서

브라우저가 응답과 함께 전달된 인증서 정보를 확인할 수 있다. 인증서에서 해당 인증서를 발급한 CA 정보를 확인하고 인증된 CA가 발급한 인증서가 아니라면 경고창을 보여준다. 인증서의 도메인 정보와 데이터 제공자의 도메인 정보가 다른 '중간자 공격'을 감지하여 보안 위협으로부터 사용자 및 사용자의 데이터를 보호할 수 있다.

### hashing

어떠한 문자열에 임의의 연산을 적용하여 다른 문자열로 변환하는 것

1. 오래 걸리지 않아야 한다.
2. 고유한 해시 값을 가진다.
3. 아주 작은 단위의 변경이라도 완전히 다른 해시 값을 가져야 한다.

### salt

암호화해야 하는 값에 어떤 별도의 값을 추가하여 결과를 변형하는 것

1. 암호화만 해놓으면 해시된 결과가 늘 동일: 레인보우 테이블로 만들어서 decoding 해버리는 경우가 생긴다.
2. 원본값에 임의로 약속된 별도의 문자열을 추가하여 해시를 진행하면 알고리즘이 노출되어도 원본값을 보호할 수 있다.

**주의할 점**

- salt는 유저와 패스워드 별로 유일한 값을 가져야 한다.
- 사용자 계정을 생성할 때와 비밀번호를 변경할 때마다 새로운 임의의 salt를 사용해야 한다.
- salt는 절대 재사용하지 말아야 한다.
- salt는 db의 유저 테이블에 같이 저장되어야 한다.

**암호화 하려는 값 + salt ⇒(hashing) hash 값**

### Cookie

HTTP는 stateless(무상태성)인데 우리의 정보가 유지될 수 있는 이유가 바로 Cookie 덕분이다. 어떤 웹사이트에 들어갔을 때, 서버가 일방적으로 클라이언트에 전달하는 작은 데이터이다. 서버가 브라우저에 정보를 저장하고 불러올 수 있는 수단이다. 해당 도메인에 쿠키가 존재하면, 브라우저가 도메인에게 http 요청 시 쿠키를 함께 전달한다. 사용자 선호, 테마 등 장시간 보존해야하는 정보 저장에 적합하다. 기본적으로는 쿠키는 오랜 시간 동안 유지될 수 있고, 자바스크립트를 이용해서 쿠키에 접근할 수 있기 때문에 쿠키에 민감한 정보를 담는 것은 위험하다.

**Cookie Options**

- Domain 서버와 요청의 도메인이 일치하는 경우 쿠키 전송
- Path 서버와 요청의 세부경로가 일치하는 경우 쿠키 전송
- MaxAge or Expires 쿠키의 유효기간 설정
- HttpOnly 스크립트의 쿠키 접근 가능 여부 결정
- Secure Https 프로토콜에서만 쿠키 전송 여부 결정
- SameSite CORS 요청의 경우 옵션 및 메서드에 따라 쿠키 전송 여부 결정

### Sprint Review 정리

해싱은 입력 받은 데이터를 고정된 길이의 데이터로 변환할 때 이전 데이터를 알아볼 수 없게 만드는 것. 해싱 알고리즘에는 sha-1 sha-256 sha512 등이 있고, 숫자의 의미는 비트이다. input ⇒ output이 늘 동일한 순수함수리고, 해싱된 값은 사실상 복호화는 불가능하다.

솔트는 암호화 해야하는 원본 값에 어떤 별도의 값을 추가해서 결과를 변형하는 것. express에서는 secret으로 지정한다. 솔트는 사용자와 비밀번호 별로 유일한 값을 가져야 한다. 절대 재사용하면 안된다. 데이터베이스 사용자 테이블에 해싱된 패스워드 값, 솔트 값이 같이 저장되어야 한다.

쿠키는 HTTP의 stateless 특징을 보완해주는 도구이다. 쓰임새에는 인증 상태 저장, 장바구니, 팝업 7일간 보지 않기, 맞춤 광고 등이 있다. 

[https://howhttps.works/ko/why-do-we-need-https/](https://howhttps.works/ko/why-do-we-need-https/)

[https://crackstation.net/](https://crackstation.net/)
