---
layout: single
title: TIL DAY 116
---

# AWS 배포

### 전체적인 흐름

- 서버는 EC2로 생성한다. EC2 안에 서버를 돌리기 위한 기본적인 환경을 구축하고, 레포지토리를 clone해 동작시킨다. 로컬 환경과 값이 달라지는 변수는 .env 파일로 관리한다. cors origin을 작성할 때에는 대괄호는 쓰지 않아야 한다.
- 클라이언트는 S3로 생성하고, 버킷에 빌드한 파일을 업로드 한다. 빌드를 할 때는 REACT_APP_API_URL에 EC2 주소를 삽입해야 한다. 로드 밸런서로 연결되었다면 로드 밸런서 주소를, 도메인이 연결되었다면 도메인 주소로 연결하면 된다.
- 데이터베이스는 RDS로 생성한다. 내 로컬에서 커맨드를 입력해 RDS에서 생성한 데이터베이스로 접속할 수 있다. EC2의 .env와 config 파일을 RDS에 맞게 수정해야 한다.
- HTTPS로 구동하기 위해서는 인증 기관에서 인증을 받아야 한다. AWS에서는 Route 53이라는 DNS 서비스를 운영하고 있다. 먼저 도메인을 구입한 다음, Route 53을 통해 인증을 받고 서버는 ELB(로드 밸런서), 클라이언트는 CloudFront 서비스를 사용한다.

### 로드 밸런서

- 로드 밸런서를 생성할 때, 리스너에는 HTTP와 HTTPS 프로토콜을 모두 넣어준다. 두 프로토콜 모두에 연결할 수 있다.
- 로드 밸런서 라우팅을 구성할 때는 HTTP 프로토콜로 인스턴스와 연결한다. EC2 서버는 기본적으로 HTTP로 연결되어 있기 때문이다. HTTPS 인증을 받으면 자동적으로 HTTPS로 연결된다.
- 상태 검사 시에는 경로로 요청을 보내는데, 어떠한 API도 연결되어 있지 않으면 로드 밸런서가 인식하지 못한다. 응답이 가능한 API 경로를 삽입하면 해결된다.

### 도메인 구입

- 도메인을 구입하면 Route 53(DNS 서비스)을 사용해 호스팅 영역을 생성한다. 레코드에 값/트래픽 라우팅 대상으로 4개의 서버 네임 리스트가 나오게 되는데, 구입한 사이트에 등록해야 한다.